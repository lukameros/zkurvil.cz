<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FEHRER NL9/S - Control Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #1a1a1a;
            --bg-panel: #2a2a2a;
            --border-color: #404040;
            --text-primary: #e0e0e0;
            --text-secondary: #999;
            --accent-green: #4CAF50;
            --accent-red: #f44336;
            --accent-yellow: #FFC107;
            --accent-blue: #FFC107;
            --accent-white: #FFF9E6;
            --tab-active: #3a3a3a;
            --primary-yellow: #FFD54F;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: linear-gradient(180deg, #2a2a2a 0%, #1f1f1f 100%);
            border-bottom: 3px solid var(--accent-blue);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-family: 'Roboto Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-blue);
            letter-spacing: 2px;
        }

        .machine-info {
            border-left: 2px solid var(--border-color);
            padding-left: 20px;
        }

        .machine-model {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .machine-name {
            font-size: 18px;
            font-weight: 500;
            margin-top: 2px;
        }

        .cl-g-title {
            font-family: 'Roboto Mono', monospace;
            font-size: 48px;
            font-weight: 900;
            color: var(--accent-blue);
            letter-spacing: 8px;
            margin-left: 40px;
            text-shadow: 0 0 20px rgba(33, 150, 243, 0.5);
            border-left: 3px solid var(--accent-blue);
            padding-left: 30px;
        }

        .header-right {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .program-selector {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .current-program-label {
            font-size: 10px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .program-select {
            background: var(--bg-panel);
            border: 2px solid var(--accent-blue);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
            font-weight: 600;
            padding: 8px 15px;
            cursor: pointer;
            outline: none;
            transition: all 0.3s;
            min-width: 250px;
        }

        .program-select:hover {
            background: var(--tab-active);
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.3);
        }

        .program-select:focus {
            box-shadow: 0 0 20px rgba(33, 150, 243, 0.5);
        }

        .program-select option {
            background: var(--bg-panel);
            color: var(--text-primary);
            padding: 10px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--accent-green);
            border-radius: 5px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-green);
            box-shadow: 0 0 10px var(--accent-green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-text {
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
            font-weight: 500;
        }

        .datetime {
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-blue);
        }

        .stat-card.green::before { background: var(--accent-green); }
        .stat-card.red::before { background: var(--accent-red); }
        .stat-card.yellow::before { background: var(--accent-yellow); }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'Roboto Mono', monospace;
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-unit {
            font-size: 14px;
            color: var(--text-secondary);
            margin-left: 5px;
        }

        /* Downtime Table */
        .section-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-container {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #1f1f1f;
        }

        th {
            padding: 15px;
            text-align: left;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--border-color);
        }

        tbody tr {
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: rgba(255,255,255,0.03);
        }

        td {
            padding: 15px;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .badge.mechanical {
            background: rgba(244, 67, 54, 0.2);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }

        .badge.electrical {
            background: rgba(255, 193, 7, 0.2);
            color: var(--accent-yellow);
            border: 1px solid var(--accent-yellow);
        }

        .badge.material {
            background: rgba(33, 150, 243, 0.2);
            color: var(--accent-blue);
            border: 1px solid var(--accent-blue);
        }

        .badge.operator {
            background: rgba(156, 39, 176, 0.2);
            color: #AB47BC;
            border: 1px solid #AB47BC;
        }

        /* Bottom Tabs */
        .tabs-container {
            background: var(--bg-panel);
            border-top: 2px solid var(--border-color);
            display: flex;
            padding: 0;
        }

        .tab {
            flex: 1;
            padding: 18px 20px;
            background: var(--bg-panel);
            border: none;
            color: var(--text-secondary);
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border-right: 1px solid var(--border-color);
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab:hover {
            background: rgba(255,255,255,0.05);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--tab-active);
            color: var(--accent-blue);
        }

        .tab.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-blue);
        }

        .tab-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        /* Programs Content */
        .programs-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .program-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .program-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
        }

        .program-number {
            font-family: 'Roboto Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 10px;
        }

        .program-name {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .program-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Parameters Content */
        .parameters-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .parameter-group {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
        }

        .parameter-group-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--accent-blue);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .parameter-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .parameter-row:last-child {
            border-bottom: none;
        }

        .parameter-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .parameter-value {
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Machine Visualization */
        .machine-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            height: 100%;
        }

        .visualization-panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .carousel-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle at center, rgba(255, 197, 7, 0.05), transparent);
            border-radius: 8px;
            padding: 40px;
        }

        .carousel {
            width: 350px;
            height: 350px;
            position: relative;
        }

        .carousel-circle {
            width: 100%;
            height: 100%;
            border: 4px solid var(--primary-yellow);
            border-radius: 50%;
            position: relative;
            animation: rotateCarousel 63.83s linear infinite;
            box-shadow: 0 0 30px rgba(255, 213, 79, 0.3), inset 0 0 30px rgba(255, 213, 79, 0.1);
        }

        @keyframes rotateCarousel {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .mold-carrier {
            position: absolute;
            width: 16px;
            height: 16px;
            background: var(--primary-yellow);
            border: 2px solid var(--accent-white);
            border-radius: 3px;
            top: 50%;
            left: 50%;
            transform-origin: 0 0;
            box-shadow: 0 0 10px rgba(255, 213, 79, 0.5);
        }

        .carousel-marker {
            position: absolute;
            width: 24px;
            height: 24px;
            background: var(--accent-white);
            border: 3px solid var(--primary-yellow);
            border-radius: 50%;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 25px rgba(255, 249, 230, 0.8);
            z-index: 10;
        }

        .carousel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--bg-panel), var(--tab-active));
            border: 4px solid var(--primary-yellow);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 0 30px rgba(255, 213, 79, 0.5);
            z-index: 5;
        }

        .carousel-center-number {
            font-family: 'Roboto Mono', monospace;
            font-size: 32px;
            font-weight: 900;
            color: var(--primary-yellow);
            text-shadow: 0 0 10px rgba(255, 213, 79, 0.8);
        }

        .carousel-center-label {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 2px;
            letter-spacing: 1px;
        }

        .carousel-info {
            margin-top: 30px;
            text-align: center;
            width: 100%;
        }

        .carousel-speed {
            font-family: 'Roboto Mono', monospace;
            font-size: 36px;
            font-weight: 700;
            color: var(--primary-yellow);
            text-shadow: 0 0 15px rgba(255, 213, 79, 0.6);
        }

        .carousel-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 5px;
            letter-spacing: 1px;
        }

        /* Robot Visualization */
        .robot-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle at center, rgba(255, 197, 7, 0.05), transparent);
            border-radius: 8px;
            padding: 40px;
        }

        .robot {
            position: relative;
            width: 200px;
            height: 320px;
            animation: robotMove 4s ease-in-out infinite;
        }

        @keyframes robotMove {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .robot-base {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 130px;
            height: 45px;
            background: linear-gradient(180deg, #404040, #2a2a2a);
            border: 3px solid var(--primary-yellow);
            border-radius: 8px;
            box-shadow: 0 0 25px rgba(255, 213, 79, 0.4);
        }

        .robot-arm {
            position: absolute;
            bottom: 45px;
            left: 50%;
            transform: translateX(-50%);
            width: 65px;
            height: 190px;
            background: linear-gradient(180deg, #505050, #353535);
            border: 3px solid var(--primary-yellow);
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(255, 213, 79, 0.3);
        }

        .robot-joint {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 36px;
            height: 36px;
            background: var(--primary-yellow);
            border-radius: 50%;
            box-shadow: 0 0 25px var(--primary-yellow);
        }

        .robot-nozzle {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 45px;
            height: 65px;
            background: linear-gradient(180deg, #606060, #404040);
            border: 3px solid var(--primary-yellow);
            border-radius: 8px 8px 0 0;
            box-shadow: 0 0 20px rgba(255, 213, 79, 0.4);
        }

        .liquid-drop {
            position: absolute;
            width: 10px;
            height: 14px;
            background: var(--primary-yellow);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            animation: drip 1.5s ease-in infinite;
            box-shadow: 0 0 15px var(--primary-yellow);
        }

        @keyframes drip {
            0% {
                opacity: 0;
                bottom: -8px;
            }
            15% {
                opacity: 1;
            }
            85% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                bottom: -100px;
                transform: translateX(-50%) scale(0.4);
            }
        }

        .robot-info {
            margin-top: 40px;
            text-align: center;
            width: 100%;
        }

        .robot-status {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 213, 79, 0.2);
            border: 2px solid var(--primary-yellow);
            border-radius: 20px;
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-yellow);
            letter-spacing: 1px;
        }

        .robot-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .robot-stat {
            text-align: center;
        }

        .robot-stat-value {
            font-family: 'Roboto Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .robot-stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 3px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* NEW STYLES FOR STROJ TAB */
        .machine-container-new {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Status Info Panel */
        .status-info-panel {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(42, 42, 42, 0.95);
            border: 2px solid var(--accent-blue);
            border-radius: 8px;
            padding: 20px 25px;
            min-width: 280px;
            z-index: 10;
            box-shadow: 0 0 20px rgba(33, 150, 243, 0.3);
        }

        .status-info-panel h3 {
            font-size: 15px;
            color: var(--accent-blue);
            margin-bottom: 15px;
            font-family: 'Roboto Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .status-item-new {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 13px;
        }

        .status-label-new {
            color: var(--text-secondary);
        }

        .status-value-new {
            color: var(--text-primary);
            font-family: 'Roboto Mono', monospace;
            font-weight: 600;
        }

        /* Carousel Circle - ROTATING - SLOWER */
        .carousel-circle-new {
            width: 650px;
            height: 650px;
            border: 5px solid var(--accent-blue);
            border-radius: 50%;
            position: relative;
            background: radial-gradient(circle, rgba(33, 150, 243, 0.05) 0%, transparent 70%);
            box-shadow: 0 0 40px rgba(33, 150, 243, 0.3);
            animation: rotateCarousel 120s linear infinite; /* Much slower - 2 minutes per rotation */
        }

        @keyframes rotateCarousel {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        /* Robot v centru - STATICK√ù (mimo rotuj√≠c√≠ kruh) */
        .robot-center-new {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            z-index: 100;
            pointer-events: none;
        }

        .robot-body-new {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #555 0%, #333 100%);
            border: 3px solid var(--accent-blue);
            border-radius: 10px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 25px rgba(33, 150, 243, 0.6);
        }

        .robot-arm-new {
            width: 10px;
            height: 70px;
            background: linear-gradient(180deg, var(--accent-blue) 0%, #1976D2 100%);
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            transform-origin: bottom center;
            transition: all 0.8s ease-in-out;
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.7);
        }

        .robot-nozzle-new {
            width: 18px;
            height: 18px;
            background: var(--accent-yellow);
            border-radius: 50%;
            position: absolute;
            top: -9px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px var(--accent-yellow);
        }

        /* Liquid Stream */
        .liquid-stream-new {
            width: 5px;
            height: 0;
            background: linear-gradient(180deg, rgba(255, 193, 7, 0.9) 0%, rgba(255, 193, 7, 0.3) 100%);
            position: absolute;
            top: -9px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: height 0.3s ease-out;
            box-shadow: 0 0 12px rgba(255, 193, 7, 0.8);
        }

        .robot-center-new.pouring .liquid-stream-new {
            opacity: 1;
            height: 180px;
        }

        /* Mold Carriers - 32 nosiƒç≈Ø */
        .mold-carrier-new {
            position: absolute;
            width: 55px;
            height: 55px;
            border: 3px solid;
            border-radius: 10px;
            transition: all 0.5s ease-in-out;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            transform: rotate(0deg); /* Counter-rotate to keep carriers upright */
        }

        /* Closed carrier - RED */
        .mold-carrier-new.closed {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.4) 0%, rgba(198, 40, 40, 0.4) 100%);
            border-color: var(--accent-red);
            color: var(--accent-red);
            box-shadow: 0 0 18px rgba(244, 67, 54, 0.5);
        }

        /* Open carrier - BLUE */
        .mold-carrier-new.open {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.4) 0%, rgba(25, 118, 210, 0.4) 100%);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            box-shadow: 0 0 25px rgba(33, 150, 243, 0.7);
            transform: scale(1.15);
        }

        /* Next carrier to open - GREEN */
        .mold-carrier-new.next-open {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.4) 0%, rgba(56, 142, 60, 0.4) 100%);
            border-color: var(--accent-green);
            color: var(--accent-green);
            box-shadow: 0 0 25px rgba(76, 175, 80, 0.7);
            transform: scale(1.15);
        }

        /* Active carrier */
        .mold-carrier-new.active {
            animation: carrierPulseNew 1.5s infinite;
        }

        @keyframes carrierPulseNew {
            0%, 100% {
                box-shadow: 0 0 25px rgba(76, 175, 80, 0.7);
            }
            50% {
                box-shadow: 0 0 40px rgba(76, 175, 80, 1);
            }
        }

        /* Yellow line from robot to active carrier */
        .connection-line {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-yellow) 0%, rgba(255, 193, 7, 0.3) 100%);
            transform-origin: left center;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 50;
            box-shadow: 0 0 10px var(--accent-yellow);
            pointer-events: none;
        }

        .connection-line.active {
            opacity: 1;
        }

        /* Controls */
        .controls-new {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        .control-btn-new {
            padding: 14px 28px;
            background: var(--bg-panel);
            border: 2px solid var(--accent-blue);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .control-btn-new:hover {
            background: var(--tab-active);
            box-shadow: 0 0 20px rgba(33, 150, 243, 0.5);
            transform: translateY(-2px);
        }

        .control-btn-new.active {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: white;
            box-shadow: 0 0 25px rgba(76, 175, 80, 0.6);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <div class="logo">FEHRER</div>
            <div class="machine-info">
                <div class="machine-model">NEEDLE LOOM</div>
                <div class="machine-name">NL 9/S - 2600mm</div>
            </div>
            <div class="cl-g-title">CL-G</div>
        </div>
        <div class="header-right">
            <div class="program-selector">
                <div class="current-program-label">AKTIVN√ç PROGRAM</div>
                <select class="program-select" id="programSelect" onchange="changeProgram()">
                    <option value="P001" selected>P001 - Standard 450 g/m¬≤</option>
                    <option value="P002">P002 - Heavy Duty 800 g/m¬≤</option>
                    <option value="P003">P003 - Light 250 g/m¬≤</option>
                    <option value="P004">P004 - Automotive Felt</option>
                    <option value="P005">P005 - Carpet Backing</option>
                    <option value="P006">P006 - Technical Felt</option>
                </select>
            </div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span class="status-text">RUNNING</span>
            </div>
            <div class="datetime" id="datetime">--:--:--</div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-area">
            <!-- Tab 1: Prostoje (Downtime) -->
            <div class="tab-content active" id="prostoje">
                <div class="stats-grid">
                    <div class="stat-card green">
                        <div class="stat-label">Uptime Dnes</div>
                        <div class="stat-value">87.3<span class="stat-unit">%</span></div>
                    </div>
                    <div class="stat-card red">
                        <div class="stat-label">Celkov√Ω Prostoj</div>
                        <div class="stat-value">2.4<span class="stat-unit">hod</span></div>
                    </div>
                    <div class="stat-card yellow">
                        <div class="stat-label">Poƒçet Prostoj≈Ø</div>
                        <div class="stat-value">8</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pr≈Ømƒõrn√Ω Prostoj</div>
                        <div class="stat-value">18<span class="stat-unit">min</span></div>
                    </div>
                </div>

                <div class="section-title">
                    <span>üìä Tabulka Prostoj≈Ø</span>
                    <span style="font-size: 12px; color: var(--text-secondary);">Dnes | 03.02.2026</span>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ƒåAS ZAƒå√ÅTKU</th>
                                <th>ƒåAS KONCE</th>
                                <th>TRV√ÅN√ç</th>
                                <th>D≈ÆVOD</th>
                                <th>POPIS</th>
                                <th>OPER√ÅTOR</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>06:15:23</td>
                                <td>06:42:18</td>
                                <td>26 min</td>
                                <td><span class="badge mechanical">Mechanick√°</span></td>
                                <td>V√Ωmƒõna jehel - sector 3</td>
                                <td>J. Nov√°k</td>
                            </tr>
                            <tr>
                                <td>07:55:12</td>
                                <td>08:11:45</td>
                                <td>16 min</td>
                                <td><span class="badge material">Materi√°l</span></td>
                                <td>Chyb√≠ materi√°l</td>
                                <td>M. Svoboda</td>
                            </tr>
                            <tr>
                                <td>09:22:34</td>
                                <td>09:33:02</td>
                                <td>10 min</td>
                                <td><span class="badge operator">P≈ôest√°vka</span></td>
                                <td>Pl√°novan√° p≈ôest√°vka</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>10:45:17</td>
                                <td>11:28:55</td>
                                <td>43 min</td>
                                <td><span class="badge mechanical">Mechanick√°</span></td>
                                <td>Porucha lo≈æiska</td>
                                <td>P. Dvo≈ô√°k</td>
                            </tr>
                            <tr>
                                <td>12:05:41</td>
                                <td>12:16:23</td>
                                <td>11 min</td>
                                <td><span class="badge electrical">Elektrick√°</span></td>
                                <td>Reset ≈ô√≠d√≠c√≠ jednotky</td>
                                <td>T. Hor√°k</td>
                            </tr>
                            <tr>
                                <td>13:33:18</td>
                                <td>13:51:09</td>
                                <td>18 min</td>
                                <td><span class="badge material">Materi√°l</span></td>
                                <td>Zmƒõna materi√°lu</td>
                                <td>M. Svoboda</td>
                            </tr>
                            <tr>
                                <td>14:22:45</td>
                                <td>14:35:12</td>
                                <td>12 min</td>
                                <td><span class="badge mechanical">Mechanick√°</span></td>
                                <td>ƒåi≈°tƒõn√≠ veden√≠</td>
                                <td>J. Nov√°k</td>
                            </tr>
                            <tr>
                                <td>15:48:09</td>
                                <td>15:56:33</td>
                                <td>8 min</td>
                                <td><span class="badge operator">P≈ôest√°vka</span></td>
                                <td>Pl√°novan√° p≈ôest√°vka</td>
                                <td>-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab 2: Programy -->
            <div class="tab-content" id="programy">
                <div class="section-title">
                    <span>‚öôÔ∏è Dostupn√© Programy</span>
                </div>
                <div class="programs-grid">
                    <div class="program-card">
                        <div class="program-number">P001</div>
                        <div class="program-name">Standard 450 g/m¬≤</div>
                        <div class="program-details">RPM: 1200 | Jehly: 5000/m</div>
                    </div>
                    <div class="program-card">
                        <div class="program-number">P002</div>
                        <div class="program-name">Heavy Duty 800 g/m¬≤</div>
                        <div class="program-details">RPM: 1000 | Jehly: 7000/m</div>
                    </div>
                    <div class="program-card">
                        <div class="program-number">P003</div>
                        <div class="program-name">Light 250 g/m¬≤</div>
                        <div class="program-details">RPM: 1500 | Jehly: 3500/m</div>
                    </div>
                    <div class="program-card">
                        <div class="program-number">P004</div>
                        <div class="program-name">Automotive Felt</div>
                        <div class="program-details">RPM: 1100 | Jehly: 6000/m</div>
                    </div>
                    <div class="program-card">
                        <div class="program-number">P005</div>
                        <div class="program-name">Carpet Backing</div>
                        <div class="program-details">RPM: 1300 | Jehly: 4500/m</div>
                    </div>
                    <div class="program-card">
                        <div class="program-number">P006</div>
                        <div class="program-name">Technical Felt</div>
                        <div class="program-details">RPM: 950 | Jehly: 8000/m</div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Poruchy -->
            <div class="tab-content" id="poruchy">
                <div class="section-title">
                    <span>‚ö†Ô∏è Historie Poruch</span>
                    <span style="font-size: 12px; color: var(--text-secondary);">Posledn√≠ 7 dn√≠</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>DATUM</th>
                                <th>ƒåAS</th>
                                <th>K√ìD PORUCHY</th>
                                <th>KATEGORIE</th>
                                <th>POPIS</th>
                                <th>STAV</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>03.02.2026</td>
                                <td>10:45:17</td>
                                <td>ERR-M-047</td>
                                <td><span class="badge mechanical">Mechanick√°</span></td>
                                <td>Porucha lo≈æiska - sektor 2</td>
                                <td style="color: var(--accent-green);">‚úì Vy≈ôe≈°eno</td>
                            </tr>
                            <tr>
                                <td>02.02.2026</td>
                                <td>14:22:33</td>
                                <td>ERR-E-012</td>
                                <td><span class="badge electrical">Elektrick√°</span></td>
                                <td>V√Ωpadek nap√°jen√≠ servomotoru</td>
                                <td style="color: var(--accent-green);">‚úì Vy≈ôe≈°eno</td>
                            </tr>
                            <tr>
                                <td>01.02.2026</td>
                                <td>08:15:44</td>
                                <td>ERR-M-033</td>
                                <td><span class="badge mechanical">Mechanick√°</span></td>
                                <td>Zlomen√° jehla - batch 45</td>
                                <td style="color: var(--accent-green);">‚úì Vy≈ôe≈°eno</td>
                            </tr>
                            <tr>
                                <td>31.01.2026</td>
                                <td>16:48:09</td>
                                <td>ERR-S-008</td>
                                <td><span class="badge material">Materi√°l</span></td>
                                <td>Nekvalitn√≠ materi√°l - lot 2401</td>
                                <td style="color: var(--accent-green);">‚úì Vy≈ôe≈°eno</td>
                            </tr>
                            <tr>
                                <td>30.01.2026</td>
                                <td>11:33:21</td>
                                <td>ERR-E-019</td>
                                <td><span class="badge electrical">Elektrick√°</span></td>
                                <td>Chyba komunikace PLC</td>
                                <td style="color: var(--accent-green);">‚úì Vy≈ôe≈°eno</td>
                            </tr>
                            <tr>
                                <td>29.01.2026</td>
                                <td>09:12:55</td>
                                <td>ERR-M-041</td>
                                <td><span class="badge mechanical">Mechanick√°</span></td>
                                <td>Nadmƒõrn√° vibrace</td>
                                <td style="color: var(--accent-green);">‚úì Vy≈ôe≈°eno</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab 4: Parametry -->
            <div class="tab-content" id="parametry">
                <div class="section-title">
                    <span>üìã Aktu√°ln√≠ Parametry Stroje</span>
                </div>
                <div class="parameters-grid">
                    <div class="parameter-group">
                        <div class="parameter-group-title">PROVOZN√ç PARAMETRY</div>
                        <div class="parameter-row">
                            <span class="parameter-label">Ot√°ƒçky (RPM)</span>
                            <span class="parameter-value" data-param="rpm">1200</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">Rychlost materi√°lu</span>
                            <span class="parameter-value">45 m/min</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">Zdvih</span>
                            <span class="parameter-value">60 mm</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">Hustota jehel</span>
                            <span class="parameter-value">5000 n/m</span>
                        </div>
                    </div>

                    <div class="parameter-group">
                        <div class="parameter-group-title">MATERI√ÅL</div>
                        <div class="parameter-row">
                            <span class="parameter-label">Gram√°≈æ vstup</span>
                            <span class="parameter-value">350 g/m¬≤</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">Gram√°≈æ v√Ωstup</span>
                            <span class="parameter-value">450 g/m¬≤</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">≈†√≠≈ôka materi√°lu</span>
                            <span class="parameter-value">2600 mm</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">Typ materi√°lu</span>
                            <span class="parameter-value">PP/PES</span>
                        </div>
                    </div>

                    <div class="parameter-group">
                        <div class="parameter-group-title">TEPLOTY</div>
                        <div class="parameter-row">
                            <span class="parameter-label">Motor 1</span>
                            <span class="parameter-value" data-param="temp1">68¬∞C</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">Motor 2</span>
                            <span class="parameter-value" data-param="temp2">72¬∞C</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">Lo≈æiska</span>
                            <span class="parameter-value">55¬∞C</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">P≈ôevodovka</span>
                            <span class="parameter-value">61¬∞C</span>
                        </div>
                    </div>

                    <div class="parameter-group">
                        <div class="parameter-group-title">V√ùKON</div>
                        <div class="parameter-row">
                            <span class="parameter-label">Spot≈ôeba energie</span>
                            <span class="parameter-value">42.3 kW</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">V√Ωroba dnes</span>
                            <span class="parameter-value">3240 m</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">Efektivita</span>
                            <span class="parameter-value">87.3%</span>
                        </div>
                        <div class="parameter-row">
                            <span class="parameter-label">Bƒõhov√© hodiny</span>
                            <span class="parameter-value">14.2 h</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 5: Stroj -->
            <div class="tab-content" id="stroj">
                <div class="machine-container-new">
                    <!-- Status Info Panel -->
                    <div class="status-info-panel">
                        <h3>ü§ñ STAV ROBOTA</h3>
                        <div class="status-item-new">
                            <span class="status-label-new">Aktu√°ln√≠ nosiƒç:</span>
                            <span class="status-value-new" id="currentCarrier">1</span>
                        </div>
                        <div class="status-item-new">
                            <span class="status-label-new">Otev≈ôen√©:</span>
                            <span class="status-value-new" id="openCount" style="color: var(--accent-blue);">0</span>
                        </div>
                        <div class="status-item-new">
                            <span class="status-label-new">Zav≈ôen√©:</span>
                            <span class="status-value-new" id="closedCount" style="color: var(--accent-red);">32</span>
                        </div>
                        <div class="status-item-new">
                            <span class="status-label-new">Stav:</span>
                            <span class="status-value-new" id="robotStatus">P≈ôipraven</span>
                        </div>
                        <div class="status-item-new">
                            <span class="status-label-new">Celkem cykl≈Ø:</span>
                            <span class="status-value-new" id="totalCycles">0</span>
                        </div>
                        <div class="status-item-new">
                            <span class="status-label-new">Rychlost kruhu:</span>
                            <span class="status-value-new" style="color: var(--accent-blue);">9.4 m/min</span>
                        </div>
                    </div>

                    <!-- Carousel Circle with Robot in Center -->
                    <div style="position: relative; width: 650px; height: 650px;">
                        <!-- Rotating carousel circle -->
                        <div class="carousel-circle-new" id="carouselCircleNew">
                            <!-- 32 mold carriers budou vygenerov√°ny JS -->
                        </div>
                        
                        <!-- Yellow connection line -->
                        <div class="connection-line" id="connectionLine"></div>
                        
                        <!-- Robot v centru (mimo rotuj√≠c√≠ kruh) -->
                        <div class="robot-center-new" id="robotCenter">
                            <div class="robot-body-new">
                                <div class="robot-arm-new">
                                    <div class="robot-nozzle-new"></div>
                                    <div class="liquid-stream-new"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="controls-new">
                        <button class="control-btn-new" id="startBtn" onclick="startCycle()">‚ñ∂ START</button>
                        <button class="control-btn-new" id="pauseBtn" onclick="pauseCycle()">‚è∏ PAUZA</button>
                        <button class="control-btn-new" id="resetBtn" onclick="resetCycle()">üîÑ RESET</button>
                    </div>
                </div>
            </div>

            <!-- Tab 6: √ödr≈æba -->
            <div class="tab-content" id="udrzba">
                <div class="section-title">
                    <span>üîß Pl√°n √ödr≈æby</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>√öKOL</th>
                                <th>INTERVAL</th>
                                <th>POSLEDN√ç √öDR≈ΩBA</th>
                                <th>P≈ò√ç≈†T√ç √öDR≈ΩBA</th>
                                <th>ZB√ùV√Å</th>
                                <th>STAV</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>V√Ωmƒõna jehel</td>
                                <td>500 h</td>
                                <td>28.01.2026</td>
                                <td>15.03.2026</td>
                                <td>340 h</td>
                                <td style="color: var(--accent-green);">‚úì OK</td>
                            </tr>
                            <tr>
                                <td>Maz√°n√≠ lo≈æisek</td>
                                <td>200 h</td>
                                <td>01.02.2026</td>
                                <td>10.02.2026</td>
                                <td>85 h</td>
                                <td style="color: var(--accent-green);">‚úì OK</td>
                            </tr>
                            <tr>
                                <td>Kontrola ≈ôemen≈Ø</td>
                                <td>100 h</td>
                                <td>30.01.2026</td>
                                <td>04.02.2026</td>
                                <td>12 h</td>
                                <td style="color: var(--accent-yellow);">‚ö† Brzy</td>
                            </tr>
                            <tr>
                                <td>ƒåi≈°tƒõn√≠ filtr≈Ø</td>
                                <td>50 h</td>
                                <td>03.02.2026</td>
                                <td>05.02.2026</td>
                                <td>36 h</td>
                                <td style="color: var(--accent-green);">‚úì OK</td>
                            </tr>
                            <tr>
                                <td>Kalibrace senzor≈Ø</td>
                                <td>1000 h</td>
                                <td>15.12.2025</td>
                                <td>28.03.2026</td>
                                <td>645 h</td>
                                <td style="color: var(--accent-green);">‚úì OK</td>
                            </tr>
                            <tr>
                                <td>V√Ωmƒõna oleje</td>
                                <td>2000 h</td>
                                <td>05.11.2025</td>
                                <td>22.06.2026</td>
                                <td>1475 h</td>
                                <td style="color: var(--accent-green);">‚úì OK</td>
                            </tr>
                            <tr>
                                <td>Kompletn√≠ revize</td>
                                <td>5000 h</td>
                                <td>12.05.2025</td>
                                <td>08.01.2027</td>
                                <td>3820 h</td>
                                <td style="color: var(--accent-green);">‚úì OK</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Bottom Tabs -->
        <div class="tabs-container">
            <button class="tab active" onclick="switchTab('prostoje')">
                <span class="tab-icon">üìä</span>
                Prostoje
            </button>
            <button class="tab" onclick="switchTab('programy')">
                <span class="tab-icon">‚öôÔ∏è</span>
                Programy
            </button>
            <button class="tab" onclick="switchTab('poruchy')">
                <span class="tab-icon">‚ö†Ô∏è</span>
                Poruchy
            </button>
            <button class="tab" onclick="switchTab('parametry')">
                <span class="tab-icon">üìã</span>
                Parametry
            </button>
            <button class="tab" onclick="switchTab('stroj')">
                <span class="tab-icon">üè≠</span>
                Stroj
            </button>
            <button class="tab" onclick="switchTab('udrzba')">
                <span class="tab-icon">üîß</span>
                √ödr≈æba
            </button>
        </div>
    </div>

    <script>
        // Update datetime
        function updateDateTime() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: false 
            };
            document.getElementById('datetime').textContent = now.toLocaleString('cs-CZ', options);
        }
        updateDateTime();
        setInterval(updateDateTime, 1000);

        // Program change
        function changeProgram() {
            const select = document.getElementById('programSelect');
            const selectedProgram = select.options[select.selectedIndex].text;
            
            // Show notification (you can enhance this)
            console.log('Program zmƒõnƒõn na: ' + selectedProgram);
            
            // Optional: Add visual feedback
            select.style.borderColor = 'var(--accent-green)';
            setTimeout(() => {
                select.style.borderColor = 'var(--accent-blue)';
            }, 1000);
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.closest('.tab').classList.add('active');
        }

        // Realistic parameter updates
        let carouselSpeed = 9.4;
        let robotFlow = 2.8;
        let robotTotal = 342;
        let rpm = 1200;
        let temperature1 = 68;
        let temperature2 = 72;

        function updateParameters() {
            // Carousel speed varies slightly (¬±0.2 m/min)
            carouselSpeed = 9.4 + (Math.random() - 0.5) * 0.4;
            document.getElementById('carouselSpeed').textContent = carouselSpeed.toFixed(1) + ' m/min';
            
            // Robot flow varies (2.5 - 3.1 L/min)
            robotFlow = 2.5 + Math.random() * 0.6;
            document.getElementById('robotFlow').textContent = robotFlow.toFixed(1) + ' L';
            
            // Robot total increases slowly
            robotTotal += robotFlow / 60; // Per second
            document.getElementById('robotTotal').textContent = Math.floor(robotTotal) + ' L';
            
            // Update parameters in Parametry tab if elements exist
            const rpmElement = document.querySelector('[data-param="rpm"]');
            if (rpmElement) {
                rpm = 1200 + (Math.random() - 0.5) * 20;
                rpmElement.textContent = Math.floor(rpm);
            }
            
            const temp1Element = document.querySelector('[data-param="temp1"]');
            if (temp1Element) {
                temperature1 = 68 + (Math.random() - 0.5) * 2;
                temp1Element.textContent = Math.floor(temperature1) + '¬∞C';
            }
            
            const temp2Element = document.querySelector('[data-param="temp2"]');
            if (temp2Element) {
                temperature2 = 72 + (Math.random() - 0.5) * 2;
                temp2Element.textContent = Math.floor(temperature2) + '¬∞C';
            }
        }

        // Update parameters every second
        setInterval(updateParameters, 1000);

        // NEW CODE FOR STROJ TAB - Robot animation
        let carriers = [];
        let currentCarrierIndex = 0;
        let isRunning = false;
        let isPaused = false;
        let totalCycles = 0;
        let carriersCreated = false;
        const OPEN_BEFORE_POURING = 10;  // 10 nosiƒç≈Ø otev≈ôen√Ωch p≈ôed nal√©v√°n√≠m
        const POURING_COUNT = 20;         // Nal√©v√° do 20 nosiƒç≈Ø
        let pouringCarriers = [];         // Array pro sledov√°n√≠, kam se nal√©v√°

        // Create 32 mold carriers on new carousel
        function createNewMoldCarriers() {
            const carouselCircle = document.getElementById('carouselCircleNew');
            
            console.log('Creating carriers, element found:', carouselCircle);
            
            if (!carouselCircle) {
                console.error('carouselCircleNew not found!');
                return;
            }
            
            if (carriersCreated) {
                console.log('Carriers already created');
                return;
            }
            
            // Clear existing carriers
            carriers = [];
            const existingCarriers = carouselCircle.querySelectorAll('.mold-carrier-new');
            existingCarriers.forEach(el => el.remove());
            
            const radius = 280; // Distance from center
            const carrierCount = 32;
            
            console.log('Creating', carrierCount, 'carriers at radius', radius);
            
            for (let i = 0; i < carrierCount; i++) {
                const angle = (360 / carrierCount) * i;
                const carrier = document.createElement('div');
                carrier.className = 'mold-carrier-new closed';
                carrier.dataset.index = i;
                carrier.textContent = (i + 1);
                
                // Calculate position
                const angleRad = (angle - 90) * (Math.PI / 180);
                const x = Math.cos(angleRad) * radius;
                const y = Math.sin(angleRad) * radius;
                
                // Position on circle
                carrier.style.left = '50%';
                carrier.style.top = '50%';
                carrier.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                
                try {
                    carouselCircle.appendChild(carrier);
                    carriers.push({element: carrier, angle: angle, index: i, x: x, y: y});
                } catch (error) {
                    console.error('Error appending carrier', i, error);
                }
            }
            
            carriersCreated = true;
            console.log('Created', carriers.length, 'carriers');
            
            // Open first 10 carriers as blue
            for (let i = 0; i < OPEN_BEFORE_POURING; i++) {
                carriers[i].element.classList.remove('closed');
                carriers[i].element.classList.add('open');
            }
            
            // Mark 11th carrier as next-open (green)
            if (carriers[OPEN_BEFORE_POURING]) {
                carriers[OPEN_BEFORE_POURING].element.classList.add('next-open');
            }
            
            updateCounters();
        }

        // Update counters
        function updateCounters() {
            const openCount = carriers.filter(c => c.element.classList.contains('open')).length;
            const closedCount = carriers.filter(c => c.element.classList.contains('closed')).length;
            
            const currentCarrierEl = document.getElementById('currentCarrier');
            const openCountEl = document.getElementById('openCount');
            const closedCountEl = document.getElementById('closedCount');
            const totalCyclesEl = document.getElementById('totalCycles');
            
            if (currentCarrierEl) currentCarrierEl.textContent = currentCarrierIndex + 1;
            if (openCountEl) openCountEl.textContent = openCount;
            if (closedCountEl) closedCountEl.textContent = closedCount;
            if (totalCyclesEl) totalCyclesEl.textContent = totalCycles;
        }

        // Update robot status
        function updateRobotStatus(status) {
            const statusEl = document.getElementById('robotStatus');
            if (statusEl) statusEl.textContent = status;
        }

        // Sleep helper
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Update yellow line position
        function updateConnectionLine(carrierData) {
            const line = document.getElementById('connectionLine');
            if (!line || !carrierData) return;
            
            // Calculate distance and angle to carrier
            const distance = Math.sqrt(carrierData.x * carrierData.x + carrierData.y * carrierData.y);
            const angle = Math.atan2(carrierData.y, carrierData.x) * (180 / Math.PI);
            
            line.style.width = distance + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            line.classList.add('active');
        }

        // Hide connection line
        function hideConnectionLine() {
            const line = document.getElementById('connectionLine');
            if (line) {
                line.classList.remove('active');
            }
        }

        // Process one carrier - POURING INTO 20 CARRIERS
        async function processCarrier(index) {
            if (!isRunning || isPaused) return;
            
            const carrierData = carriers[index];
            const carrier = carrierData.element;
            const robot = document.getElementById('robotCenter');
            
            // Remove active from all carriers
            carriers.forEach(c => c.element.classList.remove('active'));
            
            // Set current carrier as active
            carrier.classList.add('active');
            currentCarrierIndex = index;
            updateCounters();
            
            // Update status
            updateRobotStatus('Nal√©v√°n√≠ do nosiƒçe ' + (index + 1) + '...');
            
            // Show yellow line to active carrier
            updateConnectionLine(carrierData);
            
            // Robot pours
            if (robot) robot.classList.add('pouring');
            await sleep(1500);
            
            if (!isRunning || isPaused) {
                if (robot) robot.classList.remove('pouring');
                hideConnectionLine();
                return;
            }
            
            // Stop pouring
            if (robot) robot.classList.remove('pouring');
            hideConnectionLine();
            carrier.classList.remove('active');
            
            // Track this as a poured carrier
            if (!pouringCarriers.includes(index)) {
                pouringCarriers.push(index);
            }
            
            // After 20 carriers have been poured, close the first 10
            if (pouringCarriers.length >= POURING_COUNT) {
                // Close the oldest open carriers
                for (let i = 0; i < OPEN_BEFORE_POURING; i++) {
                    const oldIndex = pouringCarriers[i];
                    carriers[oldIndex].element.classList.remove('open');
                    carriers[oldIndex].element.classList.add('closed');
                }
            }
            
            // Open next carrier and mark the one after as green
            const nextIndex = (index + 1) % 32;
            if (nextIndex < carriers.length) {
                // Remove green from all
                carriers.forEach(c => c.element.classList.remove('next-open'));
                
                // Open next if not already open
                if (!carriers[nextIndex].element.classList.contains('open')) {
                    carriers[nextIndex].element.classList.remove('closed');
                    carriers[nextIndex].element.classList.add('open');
                }
                
                // Mark 11th ahead as green
                const greenIndex = (index + OPEN_BEFORE_POURING + 1) % 32;
                if (carriers[greenIndex] && carriers[greenIndex].element.classList.contains('closed')) {
                    carriers[greenIndex].element.classList.add('next-open');
                }
            }
            
            await sleep(300);
            updateCounters();
            
            // Move to next carrier
            if (isRunning && !isPaused) {
                if (nextIndex === 0) {
                    totalCycles++;
                }
                processCarrier(nextIndex);
            } else {
                updateRobotStatus('P≈ôipraven');
            }
        }

        // Start cycle
        function startCycle() {
            console.log('Start cycle called');
            
            // Make sure carriers are created
            if (!carriersCreated) {
                console.log('Creating carriers from start button');
                createNewMoldCarriers();
            }
            
            if (!isRunning) {
                isRunning = true;
                isPaused = false;
                pouringCarriers = [];  // Reset pouring tracking
                const startBtn = document.getElementById('startBtn');
                const pauseBtn = document.getElementById('pauseBtn');
                if (startBtn) startBtn.classList.add('active');
                if (pauseBtn) pauseBtn.classList.remove('active');
                updateRobotStatus('Spu≈°tƒõno...');
                processCarrier(currentCarrierIndex);
            } else if (isPaused) {
                isPaused = false;
                const pauseBtn = document.getElementById('pauseBtn');
                if (pauseBtn) pauseBtn.classList.remove('active');
                processCarrier(currentCarrierIndex);
            }
        }

        // Pause cycle
        function pauseCycle() {
            if (isRunning) {
                isPaused = true;
                const pauseBtn = document.getElementById('pauseBtn');
                if (pauseBtn) pauseBtn.classList.add('active');
                updateRobotStatus('Pozastaveno');
                hideConnectionLine();
            }
        }

        // Reset cycle
        function resetCycle() {
            console.log('Reset cycle called');
            
            // Make sure carriers are created
            if (!carriersCreated) {
                console.log('Creating carriers from reset button');
                createNewMoldCarriers();
                return;
            }
            
            isRunning = false;
            isPaused = false;
            currentCarrierIndex = 0;
            totalCycles = 0;
            pouringCarriers = [];
            
            const startBtn = document.getElementById('startBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            if (startBtn) startBtn.classList.remove('active');
            if (pauseBtn) pauseBtn.classList.remove('active');
            
            // Reset robot
            const robot = document.getElementById('robotCenter');
            if (robot) {
                robot.classList.remove('pouring');
            }
            
            hideConnectionLine();
            
            // Reset all carriers - first 10 open (blue), rest closed
            carriers.forEach((carrierData, i) => {
                carrierData.element.classList.remove('open', 'active', 'next-open');
                if (i < OPEN_BEFORE_POURING) {
                    carrierData.element.classList.remove('closed');
                    carrierData.element.classList.add('open');
                } else {
                    carrierData.element.classList.remove('open');
                    carrierData.element.classList.add('closed');
                }
            });
            
            // Mark 11th as green
            if (carriers[OPEN_BEFORE_POURING]) {
                carriers[OPEN_BEFORE_POURING].element.classList.add('next-open');
            }
            
            updateCounters();
            updateRobotStatus('P≈ôipraven');
        }

        // Enhanced tab switching to create carriers when Stroj tab is opened
        (function() {
            const originalSwitchTab = window.switchTab;
            window.switchTab = function(tabName) {
                if (originalSwitchTab) {
                    originalSwitchTab.call(this, tabName);
                }
                
                console.log('Switched to tab:', tabName);
                
                // When switching to Stroj tab, create carriers
                if (tabName === 'stroj') {
                    setTimeout(() => {
                        console.log('Tab switched to stroj, creating carriers');
                        if (!carriersCreated) {
                            createNewMoldCarriers();
                        }
                    }, 100);
                }
            };
        })();

        // Initialize on page load with multiple attempts
        let initAttempts = 0;
        const maxAttempts = 10;
        
        function tryInitCarriers() {
            initAttempts++;
            console.log('Init attempt', initAttempts);
            
            const carouselCircle = document.getElementById('carouselCircleNew');
            if (carouselCircle && !carriersCreated) {
                console.log('Element found, creating carriers');
                createNewMoldCarriers();
            } else if (initAttempts < maxAttempts) {
                console.log('Element not found yet, trying again...');
                setTimeout(tryInitCarriers, 200);
            } else {
                console.error('Failed to find carouselCircleNew after', maxAttempts, 'attempts');
            }
        }
        
        // Start trying to initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(tryInitCarriers, 100);
            });
        } else {
            setTimeout(tryInitCarriers, 100);
        }
    </script>
</body>
</html>